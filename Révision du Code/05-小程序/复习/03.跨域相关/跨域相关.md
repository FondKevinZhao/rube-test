# 跨域相关

1. 问题一：什么是跨域
   1. 违反了同源策略
   2. 同源策略：当前HTML的请求地址和请求数据的请求地址的协议名+域名+端口号完全相同
   3. 同源策略是为了保护用户的资料
   
2. 问题二：跨域一定会报错吗
   1. 不一定
   2. 服务器和服务器之间并不会出现跨域报错(原因：发送的是http请求)
   3. 在使用link，script，img等标签获取跨域资源的时候，也不报错(原因：发送的是http请求)
   
3. 问题三：什么情况下会出现跨域问题
   1. 浏览器上才会出现跨域问题
      1. 跨域问题其实是浏览器搞的鬼，目的是为了保护用户的资料
   2. 在发送ajax(async javascript and xml)请求的时候才会出现跨域报错
      1. ajax请求只存于浏览器端，但是浏览器端不只有ajax请求
   
4. 问题四：哪些请求算是ajax请求
   1. ajax其实不是一种请求分类，他是一种浏览器发送http请求的技术
   2. 当你使用js中的ajax技术发送请求才有可能出现跨域问题
   
5. 跨域解决方案
   1. jsonp
      1. 原理：2.3中script标签发送的是HTTP请求，不会报跨域问题
      2. 实现流程:
         1. 在全局声明一个函数，后续用于接收实参
         2. 当用户点击按钮的时候，创建script标签，通过src属性，请求对应服务器，并且把1中声明的函数名称传递给服务器
         3. 服务器接收到函数名称，并返回文本内容(函数名(数据))，最终网页会将这段文本内容当作js自动执行
      
   2. cors(跨域资源共享)
      1. 原理：由于跨域报错是浏览器搞的鬼，所以可以关闭掉这个检测
         1. 浏览器其实是等到响应回来的时候才进行校验，也就是说请求已经到过服务器了
      
      2. 实现流程:
         1. 当需要返回响应的时候,设置响应头即可
            1. Access-Control-Allow-Origin:"*"	允许所有域名请求当前资源
            1. Access-Control-Allow-Origin: http://manage.leyou.com 只允许http://manage.leyou.com域名跨域
      
      3. 注意:
      
         简单请求和复杂请求
         1. 简单请求满足以下条件
            1. 请求方式是以下三种方式之一：HEAD、GET、POST
            
               head：类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头。
            
            2. HTTP的头信息不超出以下几种字段
               1. Accept、Accept-Language、Content-Language、Last-Event-ID、Content-Type但是Content-Type的值，只限于三个值： application/x-www-form-urlencoded、multipart/form-data、text/plain
            
         2. 简单请求和复杂请求对于服务器的区别
            1. 复杂请求在发送之前，会先发送一个option请求(派个小弟探路，你一定要活着回来)
      
   3. proxy
   
   4. nginx
   
   5. h5 中的 `window.postMessage(字符串，"*")`
   
      这里的星号的位置，表示域名地址全部支持。
   
      我们有时候需要在打开的两个页面之间之间通信（可能这种情况并不多），这时候window.postMessage就显得特别有用。
   
      window.postMessage() 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为https），端口号（443为https的默认值），以及主机  (两个页面的模数 Document.domain设置为相同的值) 时，这两个脚本才能相互通信。window.postMessage() 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。
   
      [博客地址](https://blog.csdn.net/weixin_40650646/article/details/81777398)

