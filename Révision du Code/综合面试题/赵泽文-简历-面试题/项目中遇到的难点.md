### 项目中遇到的难点

#### 后台管理系统

1. 在删除属性值的时候：给删除按钮做气泡框，用 el-popconfirm 组件绑定 onConfirm 事件(用于响应用户的确认删除操作)的时候(用的官网的confirm事件)一直没有效果，一直以为是我代码写得有问题，检查了很久没有发现。

   **解决：**后面在网上查资料，才发现需要把 confirm 改成 onConfirm 事件才行。

2. 给一条数据添加一个属性值：如，手机，添加属性名为：内存，属性值为128G，再添加128G的时候不能够添加的情况。

   当时使用到方法是some()

   遇到的问题就是：第一次添加的时候就添加不进去。原因是，两个下标一样了，也就是把第一次添加的值哪去这个数组中去比较了，把自身应该排除在外。

   ```js
   // 监视用户输入框失去焦点事件,切回span标签进行展示效果
   const toLook = (row: AttrValueModel, index: number) => {
       // 如果没有数据,或者都是空格,就删除该条记录
       if (!row.valueName.trim()) {
           attrForm.attrValueList.splice(index, 1);
           ElMessage.info("属性值不能为空!")
           return;
       }
   
       // 如果有数据,但是数据已经重复,也删除该条记录
       // 用于当前输入的数据在row.valueName中存储,所有的属性值都在attrForm.attrValueList数组中
       // attrForm.attrValueList是数组,内部存储是对象
       // row.valueName是字符串
       // 其实最终要的效果,是取出内部对象的valueName和row.valueName进行对比,判断是否出现过
       // filter,find,every,some都可以,但是我们需要的返回值是布尔值类型,所以排除filter,find
       // 又因为只找一个就够,所以some即可
       const result = attrForm.attrValueList.some((item, i) => {
           // 1.先判断是不是同一个人,如果是同一个人就不执行后续代码
           // 2.如果不是同一个人才判断名字
           return i !== index && item.valueName === row.valueName;
       })
   
       // 如果result值为true代表该属性已存在,需要删除
       if (result) {
           attrForm.attrValueList.splice(index, 1);
           ElMessage.info("属性值不能重复!")
           return;
       }
   
       row.isEdit = false;
   }
   ```

   

2. element-plus的bug：

   需求，在table-header里放置一个按钮，用户点击按钮会弹出一个气泡对话框，里面包含取消，确认按钮，当用户按取消，确认按钮对话框会关闭，点击其他空白处也会关闭。
    根据UI提供的样式，使用了el-popover组件，它可以自定义内容，放置我们想要的，这里 trigger 属性被用来决定 popover 的触发方式，支持的触发方式： hover、click、focus 或 contextmenu。 如果你想手动控制它，你可以设置 `v-model:visible`，如果我们想要添加取消确认按钮去控制它，设置了 `v-model:visible`，这个时候就会发现当点击空白的时候，窗口不会关闭，就很烦躁，本来以为加个属性就好了，结果这个问题我百度了好久好久，都想放弃了，最后终于让我解决了

   **解决：使用ref和它自带的hide方法**

   ```vue
   <template>
    <el-popover trigger="click" ref="setRemovePop" placement="top" :width="160">
      <p>Are you sure to delete this?</p>
      <div style="text-align: right; margin: 0">
        <el-button size="small" text @click="cancelRemove()">取消</el-button>
        <el-button size="small" type="primary" @click="cancelRemove()"
          >确定</el-button
        >
      </div>
      <template #reference>
        <el-button >Delete111</el-button>
      </template>
    </el-popover>
   </template>
   
   <script  setup>
   import { ref,onMounted } from 'vue'
   let setRemovePop = ref(null);
   const cancelRemove = ()=>{
        setRemovePop.value.hide();
   }
   
   </script>
   ```

   

   [popover气泡卡片地址](https://element-plus.gitee.io/zh-CN/component/popover.html#%E5%B5%8C%E5%A5%97%E6%93%8D%E4%BD%9C)

   [博客地址](http://events.jianshu.io/p/3e8e94cff924)

#### 商城



<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e97fa368a3e542ccb41539a6f0546aa8~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp">

1. vue-router 升级到 3.1.x 后，重复点击导航时，控制台出现报错 ，虽然不影响功能使用，但也不能视而不见。

   报错原因：vue router ≥ v3.1 后 ，回调形式改成 promise api 了，返回的是 promise，如果没有捕获到错误，控制台始终会出现如上图的警告。

   解决方法：

   1. 降低版本`npm i vue-router@3.0 -S`

   2. 在 router 文件夹增加下列代码

      ```js
      const routerPush = Router.prototype.push
      Router.prototype.push = function push(location) {
        return routerPush.call(this, location).catch((error) => error)
      }
      ```

      

   3. 捕获异常：

      ```js
      // 捕获router.push异常
      this.$router.push(route).catch((err) => {
        console.log('输出报错', err)
      })
      ```

      

   4. 补齐 router 第三个参数

      ```js
      // 补齐router.push()的第三个参数
      this.$router.push(
        route,
        () => {},
        (e) => {
          console.log('输出报错', e)
        }
      )
      ```

      [博客链接](https://juejin.cn/post/6878216531730235399)

2. 

#### 小程序

