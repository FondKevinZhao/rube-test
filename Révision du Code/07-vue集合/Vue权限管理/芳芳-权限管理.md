[视频地址](https://www.bilibili.com/video/BV1Mq4y1x7kh?spm_id_from=333.880.my_history.page.click&vd_source=ba9278b625c8ac0175e9312cb9cfed59)

### 权限管理的两种方式(都常用)

权限管理肯定是需要后端的支持和配合。我们前端其实并不知道当前登录的用户，他究竟是超级管理员还是说管理员或者某一个角色。但是后端知道。

**这里主要讲第一种**

#### 1. 后端返回什么，前端展示什么

把用户输入的信息传给后端，后端会根据传过来的信息进行一个匹配的内容返回。

后端需要你告知你当前的路径和组件位置等信息。

#### 2. 后端返回的是角色信息

这种方式前端就会比较麻烦。

如：管理员、老师、学生等，前端根据角色拼接数据信息，然后进行展示。

如：管理员返回1， 老师返回2，学生返回3等



### 动态路由

大厂的实战项目中都会涉及到权限控制，登录的用户角色不同，展示不同的导航菜单及动态路由，本课题由浅入深让你掌握多种方式。

#### 本节将会涉及到以下知识点：

1. 静态数据加载
2. 公共数据复用
3. 请求、响应拦截器
4. 使用router.Routes动态添加路由
5. vuex数据缓存

#### 1. 静态数据加载

route路由文件

```js
const routes = [
    {
        path: '/',
        redirect: '/home'
    },
    {
        path: '/home',
        name: 'home',
        meta: {title: '首页'},
        component: () => import('../views/rightMain/content/Home.vue')
    },
    {
        path: '/testA',
        name: 'testA',
        meta: { title: '企业管理' },
        component: () => import('../views/rightMain/content/TestA.vue')
    },
    {
        path: '/testB',
        name: 'testB',
        meta: { title: '财务管理' },
        component: () => import('../views/rightMain/content/TestB.vue')
    },
]
```

组件数据定义：

```vue
template
<!-- 默认数据 -->
<li v-for="(v, i) in lists" :key="i">
	<router-link :to="v.url">
    	<i class="iconfont" :class="v.icon"></i>
        <span>{{ v.title }}</span>
    </router-link>
</li>

data() {
	return {
		lists: [
			{title: '首页', icon:'iconshouye1', url: '/home'},
			{title: '企业管理', icon:'iconqiye', url: '/TestA'},
			{title: '财务管理', icon:'iconcaiwu', url: '/TestB'},
			{title: '产品管理', icon:'iconchanpin', url: '/TestC'},
			{title: '订单管理', icon:'iconorder-copy', url: '/testD'},
			{title: '管理会员', icon:'iconhuiyuan', url: '/testE'},
			{title: '数据概括', icon:'iconshuju', url: '/testF'},
		]
	}
}
```



#### 2. 公共数据复用

考虑路由和左侧导航数据的统一性，建议放在公共文件中管理

这样子做的作用：以后要修改内容，只需要修改utils下的navData.js就可以了

公共数据 — 放在utils文件夹中的navData.js

```js
// 导航与路由数据
export default [
    {name: 'home', title: '首页', path: '/home', component: 'Home', icon: 'iconshouye1'},
    {name: 'testA', title: '企业管理', path: '/testA', component: 'TestA', icon: 'iconqiye'}
]
```

router路由文件中

```js
navData.forEach(item => {
    routes.push({
        path: item.path,
        name: item.name,
        meta: {title: item.title},
        component: () => import('../views/rightMain/content' + item.component)
    })
})
```

组件中的处理

```vue
import navData from '@/utils/navData' // 外部引入

export default {
    name: 'Home',
    data() {
        return navData
    }
}

template渲染
<li v-for="(v, i) in navData" :key="i">
	<router-link :to="v.path">
    	<i class="iconfont" :class="v.icon"></i>
        <span>{{ v.title }}</span>
    </router-link>
</li>
```





#### 3. 动态添加路由数据

在router/index.js中

```js
// 路由拦截
router.beforeEach((to, from, next) => {
    // 动态生成路由数据
    addRoutes()
    next()
})

function addRoutes() {
    // getNavData是一个接口
    getNavData().then(res=>{
        // 获取数据
        console.log(res)
        // 拼接数据(路由)
        let data = routesData(res.data.result)
        // 为了减少请求，要对数据进行缓存 --- 存入vuex -- 要先引入
        // 缓存的是，请求来的数据res.data.result(是一个)，不是data
        store.dispatch('SETNAV', res.data.result)
        // 动态添加
        router.addRoutes(data)
    })
}

// 拼接数据(路由)
function routesData(result) {
    result.forEach(item=>{
       
        routes.push({
            path: item.path,
            name: item.name,
            meta: { title: item.title },
            component: () => import('../views/rightMain/content' + item.component)
        })
    })
    // 遍历数据后，一定要返回，不然addRoutes中的data为undefined
    return routes
}
```


