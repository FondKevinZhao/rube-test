# day04

## setState 是同步还是异步

既能是同步，也能是异步的

1. 同步
   在定时器或原生 DOM 事件中

2. 异步

- 在 React 合成事件或生命周期函数中
- `this.setState({})` 多次调用 setState 会合并成一次，只会重新渲染一次，多次更新数据会合并成一个（覆盖）
- `this.setState(() => {})` 多次调用 setState 会合并成一次，只会重新渲染一次，多次更新对 state 的操作都会生效

## 谈谈闭包

1. 概念

通过 Chrome 开发调试工具查看，闭包是存在嵌套内部函数中 Closure “对象”，这个“对象”包含着对外部函数的局部变量的引用

2. 产生的条件

- 函数嵌套
- 内部函数引用外部函数的局部变量
- 调用外部函数

3. 优点/作用

- 延长局部变量的生命周期
- 让函数外部操作函数内部的数据

4. 缺点

- 可能导致内存泄漏
- 解决：让内部函数成为垃圾对象

5. 应用

- 在 React 中，为了复用函数定义高阶函数，此时使用了闭包

## 谈谈跨域

1. 什么是跨域

违背了同源策略，就会产生跨域

2. 什么是同源策略

要求协议名、域名、端口号，三者必须完全一致

3. 什么样的请求会产生跨域

只有 ajax 请求才会产生跨域
只有浏览器才会检查跨域，服务器不会检查

4. 解决

- jsonp
  - 原理：利用 script 可以跨域的特性进行跨域
  - 使用
    - 创建 script 标签
    - 定义回调函数（请求成功的回调函数）
    - 设置 script 标签的 src 属性（请求地址）
    - 添加到页面中生效（发送请求）
- cors

  - 原理：http 协议规则
  - 使用：
    - 服务器设置响应头
    - `access-control-allow-origin: *`
    - `access-control-allow-methods: GET,POST,PUT,DELETE,OPTIONS`
    - `access-control-allow-headers: token`
    - `access-control-max-age: 3600000`

- 服务器代理
